#!/bin/bash

# Elite Night Mode Toggle - Terminal Edition
# Matches our custom engine perfectly

SERVICE="io.github.kernel_ux.EliteNightLight"
OBJ="/io/github/kernel_ux/EliteNightLight"
IFACE="io.github.kernel_ux.EliteNightLight.Manager"

# 1. Handle explicit 'off' or '0'
if [[ "$1" == "off" || "$1" == "0" ]]; then
    echo "Turning Night Mode OFF..."
    busctl --user call $SERVICE $OBJ $IFACE SetEnabled b false
    exit 0
fi

# 2. Handle levels 1, 2, or 3
if [[ "$1" =~ ^[1-3]$ ]]; then
    LEVEL=$(( $1 ))
    echo "Setting Night Mode to Level $LEVEL..."
    # IMPORTANT: Enable FIRST, then set Level, because Enable might reset to default!
    busctl --user call $SERVICE $OBJ $IFACE SetEnabled b true
    busctl --user call $SERVICE $OBJ $IFACE SetLevel y $LEVEL
    exit 0
fi

# 3. No arguments? Show help or just toggle
if [[ -n "$1" ]]; then
    echo "Usage: toggle-night-mode [off | 1 | 2 | 3]"
    echo "  off : Disable Night Mode"
    echo "  1   : Soft Intensity"
    echo "  2   : Warm Intensity"
    echo "  3   : Strong Intensity"
    exit 1
fi

# Default behavior: Toggle
STATUS=$(busctl --user call $SERVICE $OBJ $IFACE Enabled)

if [[ "$STATUS" == *"true"* ]]; then
    echo "Night Mode is ON. Turning it OFF..."
    busctl --user call $SERVICE $OBJ $IFACE SetEnabled b false
else
    echo "Night Mode is OFF. Turning it ON..."
    busctl --user call $SERVICE $OBJ $IFACE SetEnabled b true
fi
